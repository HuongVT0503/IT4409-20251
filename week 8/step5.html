<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 8
    </title>
    <script src='https://unpkg.com/react@18/umd/react.development.js'></script>
    <script src='https://unpkg.com/react-dom@18/umd/react-dom.development.js'></script>
    <script src='https://unpkg.com/@babel/standalone/babel.min.js'></script>
    <style type="text/css">

        #root{
            display:flex;
            margin:auto;
            justify-content:center;
            align-items: center;
        }


        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        /* Modal Content */
        .modal-content {
            background: #fff;
            padding: 6px;
            width: 300px;
        }
        table{
            margin:3vh auto;
            border-collapse: collapse;/*merges adjacent cell borders into a single border instead of showing them separately.*/
            width: 100%;
            text-align: left;
            border: solid 1px black;
            padding:5px;
        }
        tr,td{
            margin:3vh auto;
            border-collapse: collapse;/*merges adjacent cell borders into a single border instead of showing them separately.*/
            
            text-align: left;
            border: solid 1px black;
            padding:5px;

        }
        #tableheader{
            background-color: rgb(220, 157, 151);
            color: white;
        }


        input{
            box-sizing: border-box;
            width:100%;
            padding:5px;
        
        
        }

        .input-search{
            box-sizing: border-box;
            width:85%;
            padding:5px;
            border:1px solid black;
        }


        .btn-edit{
            background-color: seagreen;
            color:white;
            padding:5px;

        }
        .btn-delete{
            background-color: red;
            color:white;
            padding:5px;
        }
        



    </style>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        function App() {
            const [kw, setKeyword] = React.useState("");
            const [newUser, setNewUser] = React.useState(null);

            return (
                <div>
                    <h1>Quản lý người dùng</h1>
                    <SearchForm onChangeValue={setKeyword} />
                    <AddUser onAdd={setNewUser} />
                    <ResultTable keyword={kw} user={newUser} onAdded={() => setNewUser(null)} />
                </div>
            );

        }



        function SearchForm({ onChangeValue }) {
            return (
                <input className="input-search" type="text" placeholder="Tìm theo name, username" onChange={(e) => onChangeValue(e.target.value)} />
            );
        }




        function ResultTable({ keyword, user, onAdded }) {
            const [users, setUsers] = React.useState([]);
            const [loading, setLoading] = React.useState(true);
            const [editing, setEditing] = React.useState(null);



            React.useEffect(() => {
                fetch("https://jsonplaceholder.typicode.com/users")
                    .then(res => res.json())
                    .then(data => { setUsers(data) });
            }, []);

            const filteredUsers = users.filter(
                (u) => u.name.toLowerCase().includes(keyword.toLowerCase()) ||
                    u.username.toLowerCase().includes(keyword.toLowerCase())
            );

            React.useEffect(() => {
                if (user) {
                    setUsers((prev) => [...prev, { ...user, id: prev.length + 1 }]);
                    onAdded();
                }
            }, [user]);
            function editUser(user) {
                setEditing({ ...user, address: { ...user.address } });
            }
            {/*sao chep du lieu user sang editing khi user click SUa button*/ }



            const handleChange = (e) => {
                const { id, value } = e.target;
                if (["street", "suite", "city"].includes(id)) {
                    setEditing({
                        ...editing, address: {
                            ...editing.address,
                            [id]: value
                        }
                    });
                } else {
                    setEditing({ ...editing, [id]: value });
                }
            }
            function handleSave() {
                setUsers(prev => prev.map(u => u.id === editing.id ? editing :
                    u));
                setEditing(null);
            }

            function removeUser(id) {
                //delete, no need to double check
                //keep all users w id != (id to delete)
                setUsers((prev) => prev.filter((u) => u.id != id)); //prev ensures using the latest users array
                //React doesn't allow directly alter state / user array
                //-> create a new array w filter() that has all existing ids except from the one to delete
            }




            return (
                <div>
                    <table>
                        <thead id="tableheader">
                            <tr>
                                <td>ID</td>
                                <td>Họ tên</td>
                                <td>Username</td>
                                <td>Email</td>
                                <td>Địa chỉ</td>
                                <td>Số điện thoại</td>
                                <td>Thao tác</td>
                            </tr>
                        </thead>
                        <tbody>
                            {filteredUsers.map((u) => (
                                <tr key={u.id}>
                                    <td>{u.id}</td>
                                    <td>{u.name}</td>
                                    <td>{u.username}</td>
                                    <td>{u.email}</td>
                                    <td>
                                        {u.address?.street}, {u.address?.suite}, {u.address?.city}
                                    </td>
                                    <td>{u.phone}</td>
                                    <td>
                                        <button onClick={() => editUser(u)} className="btn-edit">Sửa</button>
                                        <button onClick={() => removeUser(u.id)} className="btn-delete">Xóa</button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                    {editing && (
                        <div className="modal-overlay">
                            <div className="modal-content">
                                <h4>Sửa người dùng</h4>
                                <label htmlFor="name">Name</label>
                                <input id="name" type="text" value={editing.name}
                                    onChange={handleChange} />
                                <label htmlFor="username">Username</label>
                                <input id="username" type="text" value={editing.username}
                                    onChange={handleChange} />
                                <label htmlFor="email">Email</label>
                                <input id="email" type="text" value={editing.email}
                                    onChange={handleChange} />
                                <label htmlFor="street">Street</label>
                                <input id="street" type="text" value={editing.street}
                                    onChange={handleChange} />
                                <label htmlFor="suite">Suite</label>
                                <input id="suite" type="text" value={editing.suite}
                                    onChange={handleChange} />
                                <label htmlFor="city">City</label>
                                <input id="city" type="text" value={editing.city}
                                    onChange={handleChange} />
                                <label htmlFor="phone">Phone</label>
                                <input id="phone" type="text" value={editing.phone}
                                    onChange={handleChange} />


                                <button onClick={handleSave}>Lưu</button>
                                <button onClick={() => setEditing(null)}>Hủy</button> {/*khi func k co tham so thi viet cach nao cung duojc, con neu co tham so thi bat buoc phai viet kieu setEditing*/}
                            </div>
                        </div>
                    )}


                </div>

            );
        }


        function AddUser({ onAdd }) {
            const [adding, setAdding] = React.useState(false);
            const [user, setUser] = React.useState(
                { name: "", username: "", email: "", address: { street: "", suite: "", city: "" }, phone: "" }
            )
            const handleChange = (e) => {
                const { id, value } = e.target;
                if (["street", "suite", "city"].includes(id)) {
                    setUser({ ...user, address: { ...user.address, [id]: value } });
                } else {
                    setUser({ ...user, [id]: value });
                }
            }
            const handleAdd = () => {
                if (user.name === "" || user.username === "") {
                    alert("Vui lòng nhập Name và Username");
                    return;
                }
                onAdd(user);
                setUser(
                    { name: "", username: "", email: "", address: { street: "", suite: "", city: "" }, phone: "" }
                )
                setAdding(false);
            }

            return (
                <div>
                    <button onClick={() => setAdding(true)}>Thêm</button>
                    {adding && (
                        <div className="modal-overlay">
                            <div className="modal-content">
                                <h4>Thêm người dùng</h4>
                                <label htmlFor="name">Name</label>
                                <input id="name" type="text" value={user.name} onChange={handleChange} /><br />
                                <label htmlFor="username">UserName</label>
                                <input id="username" type="text" value={user.username} onChange={handleChange} /><br />
                                <label htmlFor="email">Email</label>
                                <input id="email" type="text" value={user.email} onChange={handleChange} /><br />
                                <label htmlFor="street">Street</label>
                                <input id="street" type="text" value={user.address.street} onChange={handleChange} /><br />
                                <label htmlFor="suite">Suite</label>
                                <input id="suite" type="text" value={user.address.suite} onChange={handleChange} /><br />
                                <label htmlFor="city">City</label>
                                <input id="city" type="text" value={user.address.city} onChange={handleChange} /><br />
                                <label htmlFor="phone">Phone</label>
                                <input id="phone" type="text" value={user.phone} onChange={handleChange} /><br /><br />
                                <button onClick={handleAdd}>Thêm</button>
                                <button onClick={() => setAdding(false)}>Hủy</button>
                            </div>
                        </div>
                    )
                    }
                </div>
            );
        }








        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>

</body>

</html>